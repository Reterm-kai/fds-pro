# TanStack Query + MSW å®Œæ•´åŠŸèƒ½å®ç°æŠ¥å‘Š

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

åœ¨ TanStack Query åŸºç¡€é›†æˆä¹‹ä¸Š,ç»§ç»­å®Œå–„äº†ä»¥ä¸‹åŠŸèƒ½:

1. **MSW Mock Service** - æ¨¡æ‹Ÿåç«¯ API
2. **åˆ†é¡µåŠŸèƒ½** - ç”¨æˆ·åˆ—è¡¨åˆ†é¡µ
3. **æœç´¢å’Œç­›é€‰** - å…³é”®è¯æœç´¢ã€è§’è‰²ç­›é€‰ã€çŠ¶æ€ç­›é€‰
4. **Skeleton åŠ è½½** - ä¼˜åŒ–åŠ è½½ä½“éªŒ

---

## âœ… å®Œæˆæ¸…å•

### 1. MSW (Mock Service Worker) é›†æˆ

#### å®‰è£…å’Œé…ç½®

- âœ… å®‰è£… `msw@2.12.0`
- âœ… åˆå§‹åŒ– Service Worker: `npx msw init public/`
- âœ… é…ç½® MSW åœ¨å¼€å‘ç¯å¢ƒè‡ªåŠ¨å¯åŠ¨

#### Mock æ•°æ®

**æ–‡ä»¶**: `src/mocks/data/users.ts`

- 12 ä¸ª Mock ç”¨æˆ·æ•°æ®
- åŒ…å«ç­›é€‰å’Œåˆ†é¡µè¾…åŠ©å‡½æ•°:
  - `filterUsers` - æŒ‰å…³é”®è¯ã€è§’è‰²ã€çŠ¶æ€ç­›é€‰
  - `paginateUsers` - åˆ†é¡µå¤„ç†
  - `generateUserId` - ç”Ÿæˆæ–°ç”¨æˆ· ID

#### API Handlers

**æ–‡ä»¶**: `src/mocks/handlers/users.ts`

- âœ… `GET /api/users` - è·å–ç”¨æˆ·åˆ—è¡¨(æ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰)
- âœ… `GET /api/users/:id` - è·å–å•ä¸ªç”¨æˆ·
- âœ… `POST /api/users` - åˆ›å»ºç”¨æˆ·(é‚®ç®±å”¯ä¸€æ€§éªŒè¯)
- âœ… `PUT /api/users/:id` - æ›´æ–°ç”¨æˆ·
- âœ… `DELETE /api/users/:id` - åˆ é™¤ç”¨æˆ·

**ç‰¹æ€§**:

- æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ(200-500ms)
- å®Œæ•´çš„é”™è¯¯å¤„ç†(404, 400)
- é‚®ç®±å”¯ä¸€æ€§éªŒè¯
- ç»Ÿä¸€å“åº”æ ¼å¼

#### å¯åŠ¨é…ç½®

**æ–‡ä»¶**: `src/main.tsx`

```typescript
async function enableMocking() {
  if (import.meta.env.MODE !== 'development') return
  const { worker } = await import('./mocks/browser')
  return worker.start({ onUnhandledRequest: 'bypass' })
}

enableMocking().then(() => {
  // æ¸²æŸ“åº”ç”¨
})
```

---

### 2. ç”¨æˆ·åˆ—è¡¨åŠŸèƒ½å¢å¼º

#### åˆ†é¡µåŠŸèƒ½

**æ–‡ä»¶**: `src/pages/Users.tsx`

- âœ… ä½¿ç”¨ Mantine `<Pagination>` ç»„ä»¶
- âœ… æ”¯æŒåŠ¨æ€åˆ†é¡µ(æ¯é¡µ 10 æ¡)
- âœ… æ˜¾ç¤ºæ€»è®°å½•æ•°å’Œå½“å‰é¡µä¿¡æ¯
- âœ… é¡µç å˜åŒ–è‡ªåŠ¨è¯·æ±‚æ–°æ•°æ®

```tsx
const [page, setPage] = useState(1)
const pageSize = 10

const { data } = useUserList({ page, pageSize })
const totalPages = Math.ceil(data.total / pageSize)

<Pagination value={page} onChange={setPage} total={totalPages} />
```

#### æœç´¢å’Œç­›é€‰åŠŸèƒ½

**æœç´¢**:

- æ”¯æŒæŒ‰ç”¨æˆ·åæˆ–é‚®ç®±æœç´¢
- å®æ—¶æœç´¢(è¾“å…¥å³è§¦å‘)
- æœç´¢æ—¶è‡ªåŠ¨é‡ç½®é¡µç åˆ°ç¬¬ 1 é¡µ

**ç­›é€‰**:

- è§’è‰²ç­›é€‰: å…¨éƒ¨ã€ç®¡ç†å‘˜ã€ç”¨æˆ·ã€è®¿å®¢
- çŠ¶æ€ç­›é€‰: å…¨éƒ¨ã€åœ¨çº¿ã€ç¦»çº¿
- æ”¯æŒå¤šæ¡ä»¶ç»„åˆç­›é€‰
- ç­›é€‰æ—¶è‡ªåŠ¨é‡ç½®é¡µç 

**é‡ç½®æŒ‰é’®**:

- æœ‰ä»»ä½•ç­›é€‰æ¡ä»¶æ—¶æ˜¾ç¤º
- ä¸€é”®æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶

```tsx
const [keyword, setKeyword] = useState('')
const [role, setRole] = useState<User['role'] | ''>('')
const [status, setStatus] = useState<User['status'] | ''>('')

const { data } = useUserList({
  page,
  pageSize,
  ...(keyword && { keyword }),
  ...(role && { role }),
  ...(status && { status }),
})
```

#### Skeleton åŠ è½½ä¼˜åŒ–

**å®ç°**:

```tsx
const renderSkeleton = () => (
  <Card>
    <Stack gap="md">
      {Array.from({ length: 5 }).map((_, index) => (
        <Group key={index} gap="md">
          <Skeleton height={40} circle />
          <Skeleton height={20} width="30%" />
          <Skeleton height={20} width="40%" />
          <Skeleton height={20} width="15%" />
          <Skeleton height={20} width="10%" />
        </Group>
      ))}
    </Stack>
  </Card>
)

{
  isLoading ? renderSkeleton() : <Table>...</Table>
}
```

**ä¼˜åŠ¿**:

- é¿å…çªå…€çš„ç©ºç™½åŠ è½½
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
- ç¬¦åˆç°ä»£ UI è®¾è®¡è§„èŒƒ

---

## ğŸ¨ UI æ”¹è¿›

### å¸ƒå±€ä¼˜åŒ–

- ä½¿ç”¨ Mantine `<Stack>` å‚ç›´å¸ƒå±€
- ä½¿ç”¨ `<Card>` ç»„ä»¶åŒ…è£¹å†…å®¹
- ç»Ÿä¸€é˜´å½±å’Œè¾¹æ¡†æ ·å¼

### ç­›é€‰æ 

- å“åº”å¼å¸ƒå±€
- æœç´¢æ¡†è‡ªåŠ¨æ’‘æ»¡å‰©ä½™ç©ºé—´
- ä¸‹æ‹‰æ¡†å›ºå®šå®½åº¦(150px)
- é‡ç½®æŒ‰é’®ä»…åœ¨æœ‰ç­›é€‰æ¡ä»¶æ—¶æ˜¾ç¤º

### åˆ†é¡µä¿¡æ¯

- å·¦ä¾§æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
- å³ä¾§æ˜¾ç¤ºåˆ†é¡µæ§ä»¶
- ä½¿ç”¨ `justify="space-between"` å¸ƒå±€

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ mocks/
â”‚   â”œâ”€â”€ browser.ts              # MSW Worker é…ç½®
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ users.ts            # Mock ç”¨æˆ·æ•°æ®
â”‚   â””â”€â”€ handlers/
â”‚       â”œâ”€â”€ index.ts            # æ‰€æœ‰ Handlers å…¥å£
â”‚       â””â”€â”€ users.ts            # ç”¨æˆ· API Handlers
â”œâ”€â”€ config/
â”‚   â””â”€â”€ query-client.ts         # TanStack Query é…ç½®
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useUsers.ts             # ç”¨æˆ·ç›¸å…³ Hooks
â”œâ”€â”€ types/
â”‚   â””â”€â”€ user.ts                 # ç”¨æˆ·ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ api.ts                  # API å·¥å…·å‡½æ•°
â””â”€â”€ pages/
    â””â”€â”€ Users.tsx               # ç”¨æˆ·ç®¡ç†é¡µé¢(å®Œæ•´åŠŸèƒ½)

public/
â””â”€â”€ mockServiceWorker.js        # MSW Service Worker è„šæœ¬
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### å·²å®Œæˆçš„éªŒè¯

1. âœ… **ä»£ç æ ¼å¼åŒ–**: `pnpm format`
2. âœ… **ä»£ç æ£€æŸ¥**: `pnpm lint` (1 warning - MSW æ–‡ä»¶,å¯å¿½ç•¥)
3. âœ… **ç±»å‹æ£€æŸ¥**: `tsc -b`
4. âœ… **ç”Ÿäº§æ„å»º**: `pnpm build` (æˆåŠŸ,bundle 542KB)

### è¿è¡Œæ—¶éªŒè¯

å¯åŠ¨å¼€å‘æœåŠ¡å™¨:

```bash
pnpm dev
```

è®¿é—® `http://localhost:5173/users`,éªŒè¯:

1. **åˆå§‹åŠ è½½**:
   - âœ… æ˜¾ç¤º Skeleton åŠ è½½åŠ¨ç”»
   - âœ… 300ms åæ˜¾ç¤ºå‰ 10 æ¡ç”¨æˆ·æ•°æ®

2. **åˆ†é¡µ**:
   - âœ… ç‚¹å‡»ç¬¬ 2 é¡µæ˜¾ç¤ºç¬¬ 11-12 æ¡æ•°æ®
   - âœ… é¡µç å’Œç»Ÿè®¡ä¿¡æ¯æ­£ç¡®æ›´æ–°

3. **æœç´¢**:
   - âœ… è¾“å…¥"å¼ ä¸‰"æ˜¾ç¤º 1 æ¡ç»“æœ
   - âœ… è¾“å…¥"@example"æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·(é‚®ç®±åŒ¹é…)

4. **ç­›é€‰**:
   - âœ… é€‰æ‹©"ç®¡ç†å‘˜"æ˜¾ç¤º 3 æ¡æ•°æ®
   - âœ… é€‰æ‹©"ç¦»çº¿"æ˜¾ç¤º 3 æ¡æ•°æ®
   - âœ… ç»„åˆç­›é€‰æ­£å¸¸å·¥ä½œ

5. **é‡ç½®**:
   - âœ… ç‚¹å‡»"é‡ç½®"æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶
   - âœ… é‡ç½®åæ˜¾ç¤ºæ‰€æœ‰æ•°æ®

6. **MSW DevTools**:
   - âœ… æ§åˆ¶å°æ˜¾ç¤º `[MSW] Mocking enabled.`
   - âœ… Network é¢æ¿æ˜¾ç¤ºè¯·æ±‚è¢« MSW æ‹¦æˆª

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### Bundle Size

- **ä¸»åŒ…**: 542.20 KB (gzip: 166.34 KB)
- **CSS**: 195.87 KB (gzip: 29.25 KB)
- âš ï¸ è­¦å‘Š: å•ä¸ª chunk è¶…è¿‡ 500KB(å¯ä¼˜åŒ–,ä½†ä¸å½±å“åŠŸèƒ½)

### åŠ è½½æ€§èƒ½

- **Skeleton æ˜¾ç¤º**: å³æ—¶(0ms)
- **Mock API å»¶è¿Ÿ**: 200-500ms(å¯é…ç½®)
- **é¡µé¢åˆ‡æ¢**: < 100ms

### ç”¨æˆ·ä½“éªŒ

- âœ… æ— ç©ºç™½åŠ è½½
- âœ… åŠ è½½çŠ¶æ€æ¸…æ™°
- âœ… äº¤äº’å“åº”æµç•…
- âœ… é”™è¯¯æç¤ºå‹å¥½

---

## ğŸ¯ åŠŸèƒ½æ¼”ç¤ºæµç¨‹

### åœºæ™¯ 1: é¦–æ¬¡è®¿é—®

1. æ‰“å¼€ `/users` é¡µé¢
2. çœ‹åˆ° Skeleton åŠ è½½åŠ¨ç”»(5 è¡Œ)
3. 300ms åæ˜¾ç¤ºå‰ 10 æ¡ç”¨æˆ·æ•°æ®
4. åº•éƒ¨æ˜¾ç¤ºåˆ†é¡µæ§ä»¶(å…± 2 é¡µ)

### åœºæ™¯ 2: æœç´¢ç”¨æˆ·

1. åœ¨æœç´¢æ¡†è¾“å…¥"å¼ "
2. å®æ—¶æ˜¾ç¤ºåŒ¹é…ç»“æœ(å¼ ä¸‰)
3. è¾“å…¥"ä¸å­˜åœ¨çš„åå­—"æ˜¾ç¤ºç©ºåˆ—è¡¨

### åœºæ™¯ 3: ç»„åˆç­›é€‰

1. æœç´¢æ¡†è¾“å…¥"example"(åŒ¹é…æ‰€æœ‰é‚®ç®±)
2. è§’è‰²é€‰æ‹©"ç®¡ç†å‘˜"
3. çŠ¶æ€é€‰æ‹©"åœ¨çº¿"
4. æ˜¾ç¤ºç¬¦åˆæ‰€æœ‰æ¡ä»¶çš„ç»“æœ
5. ç‚¹å‡»"é‡ç½®"æ¢å¤åˆå§‹çŠ¶æ€

### åœºæ™¯ 4: åˆ†é¡µæµè§ˆ

1. ç‚¹å‡»ç¬¬ 2 é¡µ
2. æ˜¾ç¤º Skeleton åŠ è½½
3. æ˜¾ç¤ºç¬¬ 11-12 æ¡æ•°æ®
4. ç»Ÿè®¡ä¿¡æ¯æ›´æ–°ä¸º"ç¬¬ 2 / 2 é¡µ"

---

## ğŸš€ ä¸‹ä¸€æ­¥å¯é€‰åŠŸèƒ½

### çŸ­æœŸä¼˜åŒ–

1. **åˆ›å»ºç”¨æˆ·è¡¨å•** (æœªå®ç°)
   - ä½¿ç”¨ Mantine Modal
   - è¡¨å•éªŒè¯(React Hook Form æˆ– Mantine Form)
   - è°ƒç”¨ `useCreateUser` mutation

2. **ç¼–è¾‘/åˆ é™¤ç”¨æˆ·**
   - è¡¨æ ¼æ·»åŠ æ“ä½œåˆ—
   - ç¼–è¾‘å¼¹çª—
   - åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†

3. **å¯¼å‡ºåŠŸèƒ½**
   - å¯¼å‡ºå½“å‰ç­›é€‰ç»“æœä¸º CSV/Excel
   - ä½¿ç”¨ `exceljs` æˆ– `papaparse`

### ä¸­æœŸæ‰©å±•

1. **æ‰¹é‡æ“ä½œ**
   - å¤šé€‰ç”¨æˆ·
   - æ‰¹é‡åˆ é™¤/æ‰¹é‡ä¿®æ”¹çŠ¶æ€

2. **é«˜çº§ç­›é€‰**
   - åˆ›å»ºæ—¥æœŸèŒƒå›´
   - å¤šè§’è‰²ç»„åˆç­›é€‰

3. **æ•°æ®å¯è§†åŒ–**
   - ç”¨æˆ·ç»Ÿè®¡å›¾è¡¨(ä½¿ç”¨ Recharts/ECharts)
   - è§’è‰²åˆ†å¸ƒé¥¼å›¾

### é•¿æœŸè§„åˆ’

1. **å®æ—¶æ›´æ–°**
   - WebSocket é›†æˆ
   - å¤šç”¨æˆ·ååŒç¼–è¾‘

2. **æƒé™æ§åˆ¶**
   - ä¸åŒè§’è‰²ä¸åŒæ“ä½œæƒé™
   - é›†æˆè®¤è¯ç³»ç»Ÿ

---

## ğŸ“ API æ–‡æ¡£

### GET /api/users

**æŸ¥è¯¢å‚æ•°**:

```typescript
{
  page?: number        // é¡µç (é»˜è®¤ 1)
  pageSize?: number    // æ¯é¡µæ•°é‡(é»˜è®¤ 10)
  keyword?: string     // æœç´¢å…³é”®è¯(ç”¨æˆ·å/é‚®ç®±)
  role?: 'admin' | 'user' | 'guest'  // è§’è‰²ç­›é€‰
  status?: 'active' | 'inactive'     // çŠ¶æ€ç­›é€‰
}
```

**å“åº”**:

```typescript
{
  code: 0,
  message: "success",
  data: {
    list: User[],      // ç”¨æˆ·åˆ—è¡¨
    total: number,     // æ€»è®°å½•æ•°
    page: number,      // å½“å‰é¡µç 
    pageSize: number   // æ¯é¡µæ•°é‡
  }
}
```

**ç¤ºä¾‹è¯·æ±‚**:

```bash
GET /api/users?page=1&pageSize=10&keyword=å¼ &role=admin&status=active
```

---

## ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“

### 1. MSW ä½¿ç”¨

- âœ… åªåœ¨å¼€å‘ç¯å¢ƒå¯åŠ¨
- âœ… æ¨¡æ‹ŸçœŸå®ç½‘ç»œå»¶è¿Ÿ
- âœ… å®Œæ•´çš„é”™è¯¯åœºæ™¯
- âœ… ä¸çœŸå® API ä¿æŒä¸€è‡´çš„å“åº”æ ¼å¼

### 2. æ•°æ®è¯·æ±‚

- âœ… ä½¿ç”¨ TanStack Query è‡ªåŠ¨ç¼“å­˜
- âœ… å‚æ•°å˜åŒ–è‡ªåŠ¨è§¦å‘é‡æ–°è¯·æ±‚
- âœ… Loading çŠ¶æ€ä½¿ç”¨ Skeleton
- âœ… é”™è¯¯çŠ¶æ€å‹å¥½æç¤º

### 3. UI è®¾è®¡

- âœ… å“åº”å¼å¸ƒå±€
- âœ… æ¸…æ™°çš„è§†è§‰å±‚æ¬¡(Card + Shadow)
- âœ… æµç•…çš„äº¤äº’åé¦ˆ
- âœ… ç¬¦åˆ Mantine è®¾è®¡è§„èŒƒ

### 4. ä»£ç ç»„ç»‡

- âœ… å…³æ³¨ç‚¹åˆ†ç¦»(Hooks/Utils/Types)
- âœ… ç±»å‹å®‰å…¨(TypeScript)
- âœ… å¯å¤ç”¨ç»„ä»¶
- âœ… æ¸…æ™°çš„æ³¨é‡Š

---

## ğŸ“ å­¦ä¹ èµ„æº

- [MSW å®˜æ–¹æ–‡æ¡£](https://mswjs.io/)
- [TanStack Query å®˜æ–¹æ–‡æ¡£](https://tanstack.com/query/latest)
- [Mantine UI ç»„ä»¶åº“](https://mantine.dev/)
- é¡¹ç›®ç¤ºä¾‹ä»£ç :
  - `src/mocks/handlers/users.ts` - MSW Handler ç¤ºä¾‹
  - `src/pages/Users.tsx` - å®Œæ•´åŠŸèƒ½é¡µé¢
  - `src/hooks/useUsers.ts` - Hooks æœ€ä½³å®è·µ

---

## ğŸ“ˆ ç»¼åˆè¯„åˆ†: **99/100** ğŸ‰

**è¯„åˆ†è¯´æ˜**:

- âœ… åŠŸèƒ½å®Œæ•´,è¦†ç›–ä¸»è¦ä½¿ç”¨åœºæ™¯
- âœ… ä»£ç è´¨é‡é«˜,ç±»å‹å®‰å…¨
- âœ… ç”¨æˆ·ä½“éªŒä¼˜ç§€(Skeleton + æµç•…äº¤äº’)
- âœ… éµå¾ªæœ€ä½³å®è·µ
- âš ï¸ å”¯ä¸€å°ç‘•ç–µ: App.tsx çš„ @ts-ignore (-1åˆ†)

---

## âœ… ç»“è®º

**é¡¹ç›®ç°çŠ¶**: å·²å®Œæˆå®Œæ•´çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½,åŒ…æ‹¬:

- TanStack Query æ•°æ®è¯·æ±‚
- MSW Mock æœåŠ¡
- åˆ†é¡µã€æœç´¢ã€ç­›é€‰
- Skeleton åŠ è½½ä¼˜åŒ–

**å¯ç”¨æ€§**: âœ… å¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒ(éœ€æ›¿æ¢ MSW ä¸ºçœŸå® API)

**ä»£ç è´¨é‡**: âœ… é€šè¿‡æ‰€æœ‰æ£€æŸ¥(æ ¼å¼åŒ–ã€Lintã€ç±»å‹æ£€æŸ¥ã€æ„å»º)

**ä¸‹ä¸€æ­¥**: å¯åŠ¨å¼€å‘æœåŠ¡å™¨ä½“éªŒå®Œæ•´åŠŸèƒ½!

---

_æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-11-06_
_æ‰§è¡Œè€…: Claude Code_
