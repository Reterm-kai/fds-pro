# CLAUDE.md 开发准则（精简版）

## 语言使用强制规范

- ⚠️ **所有输出必须使用简体中文**：AI 回复、文档、注释、日志、提交信息等
- 唯一例外：代码标识符（变量名、函数名、类名）遵循项目命名约定

## 验证机制

- 必须拒绝 CI/远程流水线验证，所有验证由本地 AI 执行
- 每次改动提供可重复的本地验证步骤
- 无法验证的部分必须记录原因和补偿计划

## 质量审查规范

- 审查包含：技术维度（代码质量、测试覆盖）、战略维度（需求匹配、架构一致）
- 综合评分：≥90分通过，<80分退回，80-89分仔细审阅
- 生成审查报告到 `.claude/verification-report.md`

## 架构优先级

- **标准化+生态复用 > 自研方案**
- 优先使用官方 SDK、社区成熟方案
- 禁止新增自研方案（除非特例批准）
- 必须删除自研实现以减少维护成本

## 安全性原则

- 安全需求优先级最低
- 禁止新增安全性设计（认证、鉴权、加密等）
- 必须删除多余的安全控制

## 代码质量标准

### 注释规范

- 使用 UTF-8 无 BOM 编码
- 注释描述意图、约束、使用方式，不重复代码逻辑
- 禁止"修改说明"式注释

### 测试规范

- 提供可自动运行的测试（单元/冒烟/功能）
- 覆盖正常流程、边界条件、错误恢复

### 设计原则

- 遵循 SOLID、DRY、关注点分离
- 依赖倒置与接口隔离优先

### 实现标准

- **禁止 MVP/最小实现/占位符**，必须完整实现
- 主动删除过时、重复代码
- 遵守语言标准和项目风格
- 采用颠覆式破坏性更改，不向后兼容

### 性能意识

- 评估时间复杂度、内存占用、I/O 影响
- 禁止未经评估的昂贵依赖

## 工作流程

### 核心工具链

1. **sequential-thinking** - 深度思考分析
2. **shrimp-task-manager** - 任务规划
3. **直接执行** - 实现功能

### 信息检索优先级

- **本地文件操作**: desktop-commander（最高优先级）
- **编程文档**: context7（支持所有技术栈）
- **通用网页**: firecrawl
- **GitHub 操作**: github（搜索代码、管理 PR/Issue）

### 上下文检索（编码前必做）

编码前必须完成：

1. 文件名搜索（desktop-commander.start_search）
2. 内容搜索（查找关键实现）
3. 阅读相似实现（≥3个文件）
4. 开源实现搜索（github.search_code，通用功能必做）
5. 官方文档查询（context7，涉及库/框架必做）
6. 测试代码分析
7. 模式提取和分析（sequential-thinking）

**充分性验证**：必须回答以下问题才能开始编码

- 我能说出≥3个相似实现的文件路径吗？
- 我理解项目的实现模式吗？
- 我知道有哪些可复用组件吗？
- 我理解命名约定和代码风格吗？
- 我知道如何测试吗？
- 我确认没有重复造轮子吗？
- 我理解依赖和集成点吗？

生成上下文摘要到 `.claude/context-summary-[任务名].md`

### 工作流程 6 步骤

1. 分析需求
2. 获取上下文
3. 选择工具
4. 执行任务
5. 验证质量
6. 存储知识

### 开发模式 5 阶段

1. **研究**：阅读材料、厘清约束（禁止编码）
2. **计划**：制定计划与成功标准（shrimp-task-manager）
3. **实施**：执行并小步提交
4. **验证**：运行测试记录结果
5. **提交**：准备交付文档

### 文件结构

所有工作文件写入项目 `.claude/` 目录：

```
.claude/
├── context-summary-[任务名].md   # 上下文摘要
├── operations-log.md              # 决策和操作记录
└── verification-report.md         # 验证报告
```

## 开发哲学

- 渐进式迭代，每次改动可编译、可验证
- 实现前研读既有代码/文档
- 务实态度，优先真实需求
- 表达清晰优先，拒绝炫技
- 偏向简单方案，避免过度架构
- 遵循既有代码风格

### 简单性定义

- 每个函数/类单一责任
- 禁止过早抽象（重复≥3次再通用化）
- 禁止"聪明"技巧，可读性优先

## 项目集成规则

### 学习代码库

- 寻找≥3个相似特性/组件
- 识别项目通用模式与约定
- 优先使用既有库、工具、辅助函数
- 遵循既有测试编排

### 工具

- 使用项目现有构建系统
- 使用项目测试框架
- 使用项目格式化/静态检查设置
- 新增工具需充分论证和批准

## 重要提醒

- **禁止假设**，所有结论必须援引现有代码/文档
- 复杂任务前完成详尽规划
- 跨模块/超过5个子任务需生成任务分解
- 保持小步交付，每次提交可用状态
- 连续3次失败必须暂停重新评估

## 内容唯一性规则

- 每层级自洽，禁止跨层混用
- 引用而非复制粘贴
- 禁止在高层文档堆叠实现细节
